package hr.combis.service;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.support.MessageSourceAccessor;
import org.springframework.stereotype.Service;

import hr.combis.enums.ERROR_CODE;
import hr.combis.model.Person;

@Service
public class PersonServiceImpl implements IPersonService {

	@Value("${app.file.person}")
	private String personPath;

	@Autowired
	MessageSourceAccessor message;
	
	public List<Person> loadDataFromFile(){
	 	BufferedReader br = null;
        String line = "";
        String cvsSplitBy = ";";
        ArrayList<Person> persons = new ArrayList<Person>();
        try {

            br = new BufferedReader(new FileReader(personPath));
            while ((line = br.readLine()) != null) {

                String[] personRow = line.split(cvsSplitBy);
                //napuniti beanove
                Person person = new Person();
                if(!StringUtils.isEmpty(personRow[0]))
                	person.setFirstName(personRow[0]);
                else
                	person.addErrorMsg(message.getMessage(ERROR_CODE.ERR_MANDATORY.getErrorCode(), new Object[] {"ime"}));
                
                if(!StringUtils.isEmpty(personRow[1]))
                	person.setLastName(personRow[1]);
                else
                	person.addErrorMsg(message.getMessage(ERROR_CODE.ERR_MANDATORY.getErrorCode(), new Object[] {"prezime"}));
                
                if(!StringUtils.isEmpty(personRow[2]))
                	person.setZipCodeString(personRow[2],message.getMessage(ERROR_CODE.ERR_WRONG_ZIP_CODE.getErrorCode()));
                else
                	person.addErrorMsg(message.getMessage(ERROR_CODE.ERR_MANDATORY.getErrorCode(), new Object[] {"po≈°tanski broj"}));
                
                if(!StringUtils.isEmpty(personRow[3]))
                	person.setCity(personRow[3]);
                else
                	person.addErrorMsg(message.getMessage(ERROR_CODE.ERR_MANDATORY.getErrorCode(), new Object[] {"grad"}));
                
                if(!StringUtils.isEmpty(personRow[4]))
                	person.setPhone(personRow[4]);
                
                
                
                persons.add(person);
                

            }
            
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }    
		
		return persons;
	}

	
	
}
